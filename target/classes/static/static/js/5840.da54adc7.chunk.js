"use strict";(self.webpackChunkcar_wash_management=self.webpackChunkcar_wash_management||[]).push([[5840],{58203:function(e,t,a){a.r(t);var n=a(72791),i=a(5574),l=a(65661),s=a(39157),r=a(61889),d=a(48550),o=a(23786),c=a(13400),m=a(20890),p=a(94294),u=a(97123),y=a(91923),h=a(19035),g=a(22840),x=a(6879),j=a(80184);t.default=e=>{let{estimate:t,setEstimate:a,paymentModes:f,estimateCreateOpen:Z,handleClose:v,setAlertMess:C,setShowAlert:D,setAlertColor:P}=e;const[E,A]=(0,n.useState)(!1),[L,b]=(0,n.useState)(0);(0,n.useEffect)((()=>()=>{b(0)}),[]);const S=(e,n,i)=>{const l=[...t.paymentSplitList],s=l[e],r={...s,[n]:i};s.paymentId&&"ADD"!==s.flag&&(r.flag="MODIFY"),l[e]=r;const d=l.filter((e=>"CREDIT"!==e.paymentMode)).reduce(((e,t)=>e+(t.paymentAmount||0)),0),o=(t.grandTotal||0)-d;a((e=>({...e,paymentSplitList:l,pendingAmount:o>0?o:0,creditFlag:l.some((e=>"CREDIT"===e.paymentMode))})))},T=()=>{const e=(t.grandTotal||0)-t.paymentSplitList.reduce(((e,t)=>e+(t.paymentAmount||0)),0);e<=0?alert("No remaining amount to allocate. Please adjust the existing payment splits."):a((t=>({...t,paymentSplitList:[...t.paymentSplitList,{paymentAmount:e,paymentMode:"CASH",flag:"ADD"}]})))},M=()=>{A(!1)},I=(e,n,i)=>{const l=[...t.creditPaymentList],s=l[e],r={...s,[n]:i};s.paymentId&&"ADD"!==s.flag&&(r.flag="MODIFY"),l[e]=r,a((e=>({...e,creditPaymentList:l})))};return(0,j.jsxs)(j.Fragment,{children:[Z&&(0,j.jsxs)(i.Z,{open:Z,onClose:v,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",fullWidth:!0,maxWidth:"lg",children:[(0,j.jsxs)(l.Z,{id:"scroll-dialog-title",sx:{fontSize:"1.0rem"},children:["Estimate Generation for ",t.vehicleRegNo]}),(0,j.jsxs)(s.Z,{dividers:"paper"===scroll,children:[(0,j.jsx)("br",{}),(0,j.jsxs)(r.ZP,{container:!0,direction:"row",spacing:y.dv,children:[(0,j.jsx)(r.ZP,{item:!0,xs:6,children:(0,j.jsx)(d.Z,{label:"Grand Total",required:!0,variant:"outlined",value:(null===t||void 0===t?void 0:t.grandTotal)||0})}),t.paymentSplitList.filter((e=>"DELETE"!==e.flag)).map(((e,n)=>(0,j.jsxs)(r.ZP,{container:!0,item:!0,spacing:y.dv,alignItems:"center",children:[(0,j.jsx)(r.ZP,{item:!0,xs:5,children:(0,j.jsx)(d.Z,{label:"Payment Amount",variant:"outlined",fullWidth:!0,required:!0,value:e.paymentAmount,onChange:e=>S(n,"paymentAmount",parseFloat(e.target.value)||0),type:"number",disabled:!!e.paymentDate})}),(0,j.jsx)(r.ZP,{item:!0,xs:5,children:(0,j.jsx)(d.Z,{select:!0,label:"Payment Mode",variant:"outlined",fullWidth:!0,required:!0,value:e.paymentMode||"CASH",disabled:!!e.paymentDate,onChange:e=>S(n,"paymentMode",e.target.value),children:f.map((e=>(0,j.jsx)(o.Z,{value:e,children:e},e)))})}),(0,j.jsx)(r.ZP,{item:!0,xs:2,children:0===n?(0,j.jsx)(c.Z,{onClick:T,color:"primary",disabled:!!e.paymentDate,children:(0,j.jsx)(g.Z,{})}):(0,j.jsx)(c.Z,{onClick:()=>(e=>{const n=[...t.paymentSplitList],i=n[e];"ADD"===i.flag?n.splice(e,1):n[e]={...i,flag:"DELETE"},a((e=>({...e,paymentSplitList:n})))})(n),color:"secondary",disabled:!!e.paymentDate,children:(0,j.jsx)(x.Z,{})})})]},n)))]}),(0,j.jsx)("br",{}),t.creditFlag&&(0,j.jsxs)(r.ZP,{container:!0,direction:"row",spacing:y.dv,children:[(0,j.jsx)(r.ZP,{item:!0,xs:4,children:(0,j.jsx)(m.Z,{variant:"h4",children:"Credit Payment"})}),(t.creditPaymentList||[]).filter((e=>"DELETE"!==e.flag)).map(((e,n)=>(0,j.jsxs)(r.ZP,{container:!0,item:!0,spacing:y.dv,alignItems:"center",children:[(0,j.jsx)(r.ZP,{item:!0,xs:4,children:(0,j.jsx)(d.Z,{label:"Credit Amount",variant:"outlined",fullWidth:!0,required:!0,value:e.amount,onChange:e=>I(n,"amount",parseFloat(e.target.value)||0),type:"number",disabled:!!e.creditDate})}),(0,j.jsx)(r.ZP,{item:!0,xs:3,children:(0,j.jsx)(d.Z,{select:!0,label:"Payment Mode",variant:"outlined",fullWidth:!0,required:!0,value:e.paymentMode||"CASH",disabled:!!e.creditDate,onChange:e=>I(n,"paymentMode",e.target.value),children:f.filter((e=>"CREDIT"!==e)).map((e=>(0,j.jsx)(o.Z,{value:e,children:e},e)))})}),(0,j.jsx)(r.ZP,{item:!0,xs:4,children:(0,j.jsx)(d.Z,{label:"Comment",variant:"outlined",fullWidth:!0,value:e.comment||"",disabled:!!e.creditDate,onChange:e=>I(n,"comment",e.target.value)})}),(0,j.jsx)(r.ZP,{item:!0,xs:1,children:(0,j.jsx)(c.Z,{onClick:()=>(e=>{const n=[...t.creditPaymentList],i=n[e];"ADD"===i.flag?n.splice(e,1):n[e]={...i,flag:"DELETE"};const l=n.filter((e=>"DELETE"!==e.flag)).reduce(((e,t)=>e+(t.amount||0)),0),s=(t.grandTotal||0)-l;a((e=>({...e,creditPaymentList:n,pendingAmount:s>0?s:0,creditSettledFlag:0===s})))})(n),color:"secondary",disabled:!!e.creditDate,children:(0,j.jsx)(x.Z,{})})})]},n))),(0,j.jsx)(r.ZP,{item:!0,xs:12,children:(0,j.jsx)(p.Z,{onClick:()=>{const e=(t.grandTotal||0)-t.paymentSplitList.filter((e=>"CREDIT"!==e.paymentMode)).reduce(((e,t)=>e+(t.paymentAmount||0)),0)-t.creditPaymentList.reduce(((e,t)=>e+(t.amount||0)),0);e<=0?alert("No remaining amount to allocate. Please adjust the existing payment splits."):a((t=>({...t,creditPaymentList:[...t.creditPaymentList||[],{amount:e,paymentMode:"CASH",comment:"",flag:"ADD"}]})))},color:"primary",startIcon:(0,j.jsx)(g.Z,{}),children:"Add Credit Payment"})})]})]}),(0,j.jsxs)(u.Z,{children:[(0,j.jsx)(p.Z,{onClick:v,color:"secondary",children:"Close"}),(0,j.jsx)(p.Z,{onClick:async()=>{if(t.grandTotal<=0)return void alert("Grand total is 0. Cannot generate bill");const e=t.grandTotal||0,a=t.paymentSplitList.filter((e=>"DELETE"!==e.flag)),n=e-a.reduce(((e,t)=>e+(t.paymentAmount||0)),0);if(a.some((e=>!e.paymentMode)))return void alert("Please select a payment mode for all entries.");if(n>0)return void(e=>{b(e),A(!0)})(n);if(n<0)return void alert("Payment exceeds the grand total. Please adjust the amounts.");const i=t.creditPaymentList.filter((e=>"DELETE"!==e.flag));if(i.some((e=>!e.paymentMode)))return void alert("Please select a payment mode for all entries.");const l=i.reduce(((e,t)=>e+(t.amount||0)),0),s=e-a.filter((e=>"CREDIT"!==e.paymentMode)).reduce(((e,t)=>e+(t.paymentAmount||0)),0)-l,r={...t,pendingAmount:s>0?s:0,creditSettledFlag:!(s>0)};try{const e=await(0,h.j0)("/estimate",r);C("Bill id "+e.estimateId+" saved successfully"),P("success"),D(!0),v()}catch(d){C(d.message),P("info"),D(!0),v()}},color:"secondary",children:"Save"})]})]}),E&&(0,j.jsxs)(i.Z,{open:E,onClose:M,children:[(0,j.jsx)(l.Z,{children:"Confirm Remaining Amount"}),(0,j.jsx)(s.Z,{children:(0,j.jsxs)("p",{children:["The remaining amount of ",(0,j.jsx)("b",{children:L})," will be added as CREDIT. Do you want to proceed?"]})}),(0,j.jsxs)(u.Z,{children:[(0,j.jsx)(p.Z,{onClick:()=>{A(!1),a((e=>({...e,paymentSplitList:[...e.paymentSplitList,{paymentAmount:L,paymentMode:"CREDIT"}],pendingAmount:L,creditFlag:!0})))},color:"primary",children:"Yes"}),(0,j.jsx)(p.Z,{onClick:M,color:"secondary",children:"No"})]})]})]})}},6879:function(e,t,a){var n=a(76189),i=a(80184);t.Z=(0,n.Z)((0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}),"RemoveCircle")}}]);
//# sourceMappingURL=5840.da54adc7.chunk.js.map