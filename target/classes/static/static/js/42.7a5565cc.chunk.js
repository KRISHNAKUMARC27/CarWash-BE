"use strict";(self.webpackChunkcar_wash_management=self.webpackChunkcar_wash_management||[]).push([[42],{20042:function(e,t,a){a.r(t);var n=a(72791),r=a(61889),i=a(48550),o=a(20890),l=a(94294),c=a(64554),s=a(13400),h=a(27247),d=a(23735),g=a(91923),m=a(95587),p=a.n(m),u=a(19035),v=a(80184);t.default=e=>{let{data:t,updateData:a,photos:m,updatePhotos:x,zipFile:j}=e;const[w,y]=(0,n.useState)(!1),[Z,f]=(0,n.useState)(null),[P,b]=(0,n.useState)(!1);(0,n.useEffect)((()=>{j&&(async()=>{if(j){const e=new(p()),t=await e.loadAsync(j),a=[];t.forEach((async(e,t)=>{const n=await t.async("blob");a.push(new File([n],e,{type:"image/jpeg"}))})),x(a),console.log("unzipping files in useeffect")}})()}),[j,x]);return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(d.Z,{title:"Job Card Vehicle Details",children:(0,v.jsxs)(r.ZP,{container:!0,direction:"row",spacing:g.dv,children:[(0,v.jsx)(r.ZP,{item:!0,xs:4,children:(0,v.jsx)(i.Z,{label:"Vehicle Reg. No.",required:!0,variant:"outlined",value:t.vehicleRegNo||"",onChange:e=>{const n={...t,vehicleRegNo:e.target.value.toUpperCase()};a(n)}})}),(0,v.jsx)(r.ZP,{item:!0,xs:4,children:(0,v.jsx)(i.Z,{label:"Vehicle Name",required:!0,variant:"outlined",value:t.vehicleName||"",onChange:e=>{const n={...t,vehicleName:e.target.value};a(n)}})}),(0,v.jsx)(r.ZP,{item:!0,xs:4,children:(0,v.jsx)(i.Z,{label:"Vehicle K.Ms",variant:"outlined",value:t.kiloMeters||"",onChange:e=>{const n={...t,kiloMeters:e.target.value};a(n)}})}),(0,v.jsx)(r.ZP,{item:!0,xs:12,children:(0,v.jsx)(o.Z,{variant:"h6",children:"Take Photos"})}),(0,v.jsx)(r.ZP,{item:!0,xs:12,children:w?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("video",{id:"camera-preview",autoPlay:!0,playsInline:!0,style:{width:"100%",height:"auto",border:"1px solid #ccc"},ref:e=>{e&&Z&&(e.srcObject=Z)}}),(0,v.jsx)(l.Z,{variant:"contained",color:"secondary",onClick:async()=>{if(!Z)return;const e=document.querySelector("#camera-preview"),t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t.getContext("2d").drawImage(e,0,0,t.width,t.height);const a=await new Promise((e=>t.toBlob(e,"image/jpeg")));x((e=>[...e,new File([a],`photo_${e.length+1}.jpg`,{type:"image/jpeg"})]))},style:{margin:"10px"},children:"Capture Photo"}),(0,v.jsx)(l.Z,{variant:"outlined",onClick:()=>{Z&&(Z.getTracks().forEach((e=>e.stop())),f(null)),y(!1)},children:"Stop Camera"})]}):(0,v.jsxs)(r.ZP,{container:!0,direction:"row",spacing:g.dv,children:[(0,v.jsx)(r.ZP,{item:!0,xs:6,children:(0,v.jsx)(l.Z,{variant:"contained",color:"primary",onClick:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});f(e),y(!0)}catch(e){console.error("Error accessing the camera:",e),alert("Unable to access the camera.")}},children:"Start Camera"})}),(0,v.jsx)(r.ZP,{item:!0,xs:6,children:(0,v.jsx)(l.Z,{variant:"contained",color:"primary",onClick:()=>{b(!0),console.log(P)},children:"Load photos"})})]})}),(0,v.jsx)(r.ZP,{item:!0,xs:12,children:m.length>0&&(0,v.jsxs)(c.Z,{children:[(0,v.jsxs)(o.Z,{variant:"body1",children:[m.length," photo(s) captured."]}),(0,v.jsx)(r.ZP,{container:!0,spacing:2,children:m.map(((e,t)=>(0,v.jsxs)(r.ZP,{item:!0,xs:12,sm:6,md:4,style:{textAlign:"center"},children:[(0,v.jsx)("img",{src:URL.createObjectURL(e),alt:`Captured ${t+1}`,style:{width:"100%",height:"auto",maxHeight:"200px",objectFit:"contain",border:"1px solid #ccc",marginBottom:"10px"}}),(0,v.jsx)(s.Z,{color:"error",onClick:()=>(e=>{x((t=>t.filter(((t,a)=>a!==e))))})(t),"aria-label":"delete photo",children:(0,v.jsx)(h.Z,{})})]},t)))})]})}),(0,v.jsx)(r.ZP,{item:!0,xs:6,children:(0,v.jsx)(l.Z,{variant:"contained",color:"primary",onClick:()=>{0!==m.length?(m.forEach(((e,t)=>{console.log(t);const a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=e.name,a.click(),URL.revokeObjectURL(a.href)})),alert(`${m.length} photo(s) saved locally.`)):alert("No photos to save.")},disabled:0===m.length,children:"Save Photos Locally"})}),(0,v.jsx)(r.ZP,{item:!0,xs:6,children:(0,v.jsx)(l.Z,{variant:"contained",color:"primary",onClick:async()=>{try{var e,a;const n=await(0,u.A_)("/jobCard/getPhotoUrl/"+t.id);if(!n||!n.url)return void alert("Failed to retrieve the photo URL. Please try again later.");const r=null===(e=t.ownerPhoneNumber)||void 0===e?void 0:e.trim(),i=null===(a=t.vehicleRegNo)||void 0===a?void 0:a.trim();if(!r)return void alert("Please fill in the Owner Phone number.");if(!i)return void alert("Please fill in the Vehicle Registration Number.");const o=`*Greetings from CarSquare!* \ud83d\udc4b\n\n      Your car *${i}* images are ready.\n      \n      \ud83d\udcf8 Please tap the link below to download them:\n      ${n.url}\n      \n      Thank you for choosing CarSquare! \ud83d\ude97`,l=`https://api.whatsapp.com/send?phone=91${r}&text=${encodeURIComponent(o)}`;window.open(l,"_blank")}catch(n){console.error("Error sending WhatsApp message:",n.message),alert("An error occurred while trying to send the message. Please try again later.")}},disabled:0===m.length,children:"Send via WhatsApp"})})]})})})}},27247:function(e,t,a){var n=a(64836);t.Z=void 0;var r=n(a(45649)),i=a(80184),o=(0,r.default)((0,i.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");t.Z=o}}]);
//# sourceMappingURL=42.7a5565cc.chunk.js.map