{"version":3,"file":"static/js/5840.ff454d9f.chunk.js","mappings":"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","sources":["views/estimate/BillPayment.js","../node_modules/@mui/icons-material/esm/RemoveCircle.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n// material-ui\r\nimport {\r\n  Dialog,\r\n  DialogActions,\r\n  DialogContent,\r\n  DialogTitle,\r\n  Grid,\r\n  TextField,\r\n  Button,\r\n  MenuItem,\r\n  IconButton,\r\n  Typography\r\n} from '@mui/material';\r\nimport {} from '@mui/material';\r\n\r\nimport { gridSpacing } from 'store/constant';\r\nimport { postRequest } from 'utils/fetchRequest';\r\nimport { AddCircle, RemoveCircle } from '@mui/icons-material';\r\n\r\nconst BillPayment = ({\r\n  estimate,\r\n  setEstimate,\r\n  paymentModes,\r\n  estimateCreateOpen,\r\n  handleClose,\r\n  setAlertMess,\r\n  setShowAlert,\r\n  setAlertColor\r\n}) => {\r\n  const [confirmDialogOpen, setConfirmDialogOpen] = useState(false);\r\n  const [remainingAmount, setRemainingAmount] = useState(0); // To store remaining amount dynamically\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      setRemainingAmount(0);\r\n    };\r\n  }, []);\r\n\r\n  const handlePaymentSplitChange = (index, field, value) => {\r\n    const updatedPaymentSplitList = [...estimate.paymentSplitList];\r\n\r\n    // Update the specific field in the payment split list\r\n    updatedPaymentSplitList[index] = {\r\n      ...updatedPaymentSplitList[index],\r\n      [field]: value\r\n    };\r\n\r\n    // Calculate the pending amount and credit flag\r\n    const totalPaidExcludingCredit = updatedPaymentSplitList\r\n      .filter((split) => split.paymentMode !== 'CREDIT') // Exclude CREDIT payments\r\n      .reduce((sum, split) => sum + (split.paymentAmount || 0), 0); // Sum up payment amounts\r\n\r\n    const grandTotal = estimate.grandTotal || 0;\r\n    const pendingAmount = grandTotal - totalPaidExcludingCredit;\r\n\r\n    setEstimate((prevState) => ({\r\n      ...prevState,\r\n      paymentSplitList: updatedPaymentSplitList,\r\n      pendingAmount: pendingAmount > 0 ? pendingAmount : 0, // Ensure non-negative pending amount\r\n      creditFlag: updatedPaymentSplitList.some((split) => split.paymentMode === 'CREDIT') // Set creditFlag if CREDIT is used\r\n    }));\r\n  };\r\n\r\n  const addPaymentSplitRow = () => {\r\n    const grandTotal = estimate.grandTotal || 0;\r\n    const totalPaid = estimate.paymentSplitList.reduce((sum, split) => sum + (split.paymentAmount || 0), 0);\r\n    const remainingAmount = grandTotal - totalPaid;\r\n\r\n    if (remainingAmount <= 0) {\r\n      alert('No remaining amount to allocate. Please adjust the existing payment splits.');\r\n      return;\r\n    }\r\n\r\n    // Add a new row with the remaining amount prefilled\r\n    setEstimate((prevState) => ({\r\n      ...prevState,\r\n      paymentSplitList: [\r\n        ...prevState.paymentSplitList,\r\n        { paymentAmount: remainingAmount, paymentMode: '' } // Prefill paymentAmount with remaining value\r\n      ]\r\n    }));\r\n  };\r\n\r\n  const removePaymentSplitRow = (index) => {\r\n    const updatedPaymentSplitList = estimate.paymentSplitList.filter((_, i) => i !== index);\r\n    setEstimate((prevState) => ({ ...prevState, paymentSplitList: updatedPaymentSplitList }));\r\n  };\r\n\r\n  const handleOpenConfirmDialog = (remaining) => {\r\n    setRemainingAmount(remaining); // Store remaining amount for context\r\n    setConfirmDialogOpen(true);\r\n  };\r\n\r\n  // Close the confirmation dialog\r\n  const handleCloseConfirmDialog = () => {\r\n    setConfirmDialogOpen(false);\r\n  };\r\n\r\n  // Handle user confirmation (Yes to add CREDIT, No to cancel)\r\n  const handleConfirmAddCredit = () => {\r\n    setConfirmDialogOpen(false); // Close confirmation dialog\r\n    // Add remaining amount as CREDIT\r\n    setEstimate((prevState) => ({\r\n      ...prevState,\r\n      paymentSplitList: [...prevState.paymentSplitList, { paymentAmount: remainingAmount, paymentMode: 'CREDIT' }],\r\n      pendingAmount: remainingAmount,\r\n      creditFlag: true\r\n    }));\r\n    // handleClose();\r\n    // handleEstimateSave(); // Proceed with saving the estimate\r\n  };\r\n\r\n  // Handle changes in credit payments\r\n  const handleCreditPaymentChange = (index, field, value) => {\r\n    const updatedCreditPaymentList = [...estimate.creditPaymentList];\r\n\r\n    // Update the specific field in the credit payment list\r\n    updatedCreditPaymentList[index] = {\r\n      ...updatedCreditPaymentList[index],\r\n      [field]: value\r\n    };\r\n\r\n    // Calculate new pending amount\r\n\r\n    setEstimate((prevState) => ({\r\n      ...prevState,\r\n      creditPaymentList: updatedCreditPaymentList\r\n    }));\r\n  };\r\n\r\n  // Add a new credit payment row\r\n  const addCreditPaymentRow = () => {\r\n    const grandTotal = estimate.grandTotal || 0;\r\n    const totalPaid = estimate.paymentSplitList\r\n      .filter((payment) => payment.paymentMode !== 'CREDIT')\r\n      .reduce((sum, split) => sum + (split.paymentAmount || 0), 0);\r\n    const totalCreditPaid = estimate.creditPaymentList.reduce((sum, cred) => sum + (cred.amount || 0), 0);\r\n    const remainingAmount = grandTotal - totalPaid - totalCreditPaid;\r\n\r\n    if (remainingAmount <= 0) {\r\n      alert('No remaining amount to allocate. Please adjust the existing payment splits.');\r\n      return;\r\n    }\r\n\r\n    // Add a new row with the remaining amount prefilled\r\n    setEstimate((prevState) => ({\r\n      ...prevState,\r\n      creditPaymentList: [\r\n        ...(prevState.creditPaymentList || []), // Safely fallback to an empty array\r\n        { amount: remainingAmount, paymentMode: '', comment: '' } // New credit payment row\r\n      ]\r\n    }));\r\n  };\r\n\r\n  // Remove a credit payment row\r\n  const removeCreditPaymentRow = (index) => {\r\n    const updatedCreditPaymentList = estimate.creditPaymentList.filter((_, i) => i !== index);\r\n\r\n    // Recalculate pendingAmount after removing a row\r\n    const totalCreditPayments = updatedCreditPaymentList.reduce((sum, credit) => sum + (credit.amount || 0), 0);\r\n    const newPendingAmount = (estimate.grandTotal || 0) - totalCreditPayments;\r\n\r\n    setEstimate((prevState) => ({\r\n      ...prevState,\r\n      creditPaymentList: updatedCreditPaymentList,\r\n      pendingAmount: newPendingAmount > 0 ? newPendingAmount : 0,\r\n      creditSettledFlag: newPendingAmount === 0\r\n    }));\r\n  };\r\n\r\n  const handleEstimateSave = async () => {\r\n    //console.log(estimate);\r\n    if (estimate.grandTotal <= 0) {\r\n      alert('Grant total is 0. Cannot generate bill');\r\n      return;\r\n    }\r\n    const grandTotal = estimate.grandTotal || 0;\r\n    const totalPaid = estimate.paymentSplitList.reduce((sum, split) => sum + (split.paymentAmount || 0), 0);\r\n    const remaining = grandTotal - totalPaid;\r\n\r\n    console.log('REMAINING ' + remaining);\r\n    const hasEmptyPaymentMode = estimate.paymentSplitList.some((split) => !split.paymentMode);\r\n\r\n    if (hasEmptyPaymentMode) {\r\n      alert('Please select a payment mode for all entries.');\r\n      return;\r\n    }\r\n\r\n    if (remaining > 0) {\r\n      // Automatically add CREDIT for the remaining amount\r\n      console.log(\"I'm still open\");\r\n      console.log(estimate);\r\n      handleOpenConfirmDialog(remaining);\r\n      return;\r\n    } else if (remaining < 0) {\r\n      // Show alert if overpayment occurs\r\n      alert('Payment exceeds the grand total. Please adjust the amounts.');\r\n      return;\r\n    }\r\n\r\n    const updatedCreditPaymentList = [...estimate.creditPaymentList];\r\n    const hasEmptyPaymentModeCredit = updatedCreditPaymentList.some((split) => !split.paymentMode);\r\n\r\n    if (hasEmptyPaymentModeCredit) {\r\n      alert('Please select a payment mode for all entries.');\r\n      return;\r\n    }\r\n\r\n    const totalCreditPayments = updatedCreditPaymentList.reduce((sum, credit) => sum + (credit.amount || 0), 0);\r\n\r\n    const updatedPaymentSplitList = [...estimate.paymentSplitList];\r\n\r\n    const totalPaidExcludingCredit = updatedPaymentSplitList\r\n      .filter((split) => split.paymentMode !== 'CREDIT') // Exclude CREDIT payments\r\n      .reduce((sum, split) => sum + (split.paymentAmount || 0), 0); // Sum up payment amounts\r\n\r\n    const newPendingAmount = grandTotal - totalPaidExcludingCredit - totalCreditPayments;\r\n\r\n    console.log('GrandTotal ' + grandTotal);\r\n    console.log('totalPaidExcludingCredit ' + totalPaidExcludingCredit);\r\n    console.log('totalCreditPayments' + totalCreditPayments);\r\n    console.log('newPendingAmount ' + newPendingAmount);\r\n\r\n    const updatedEstimate = {\r\n      ...estimate,\r\n      pendingAmount: newPendingAmount > 0 ? newPendingAmount : 0,\r\n      creditSettledFlag: newPendingAmount > 0 ? false : true\r\n    };\r\n\r\n    try {\r\n      const data = await postRequest(process.env.REACT_APP_API_URL + '/estimate', updatedEstimate);\r\n      setAlertMess('Bill id ' + data.estimateId + ' saved successfully');\r\n      setAlertColor('success');\r\n      setShowAlert(true);\r\n      handleClose();\r\n    } catch (err) {\r\n      setAlertMess(err.message);\r\n      setAlertColor('info');\r\n      setShowAlert(true);\r\n      handleClose();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {estimateCreateOpen && (\r\n        <Dialog\r\n          open={estimateCreateOpen}\r\n          onClose={handleClose}\r\n          scroll={'paper'}\r\n          aria-labelledby=\"scroll-dialog-title\"\r\n          aria-describedby=\"scroll-dialog-description\"\r\n          fullWidth\r\n          maxWidth=\"lg\"\r\n        >\r\n          <DialogTitle id=\"scroll-dialog-title\" sx={{ fontSize: '1.0rem' }}>\r\n            Estimate Generation for {estimate.vehicleRegNo}\r\n          </DialogTitle>\r\n\r\n          <DialogContent dividers={scroll === 'paper'}>\r\n            <br></br>\r\n            <Grid container direction=\"row\" spacing={gridSpacing}>\r\n              <Grid item xs={6}>\r\n                <TextField label=\"Grand Total\" required variant=\"outlined\" value={estimate?.grandTotal || 0} />\r\n              </Grid>\r\n              {estimate.paymentSplitList.map((split, index) => (\r\n                <Grid container item spacing={gridSpacing} key={index} alignItems=\"center\">\r\n                  <Grid item xs={5}>\r\n                    <TextField\r\n                      label=\"Payment Amount\"\r\n                      variant=\"outlined\"\r\n                      fullWidth\r\n                      required\r\n                      value={split.paymentAmount}\r\n                      onChange={(e) => handlePaymentSplitChange(index, 'paymentAmount', parseFloat(e.target.value) || 0)}\r\n                      type=\"number\"\r\n                    />\r\n                  </Grid>\r\n                  <Grid item xs={5}>\r\n                    <TextField\r\n                      select\r\n                      label=\"Payment Mode\"\r\n                      variant=\"outlined\"\r\n                      fullWidth\r\n                      required\r\n                      value={split.paymentMode}\r\n                      onChange={(e) => handlePaymentSplitChange(index, 'paymentMode', e.target.value)}\r\n                    >\r\n                      {paymentModes.map((mode) => (\r\n                        <MenuItem key={mode} value={mode}>\r\n                          {mode}\r\n                        </MenuItem>\r\n                      ))}\r\n                    </TextField>\r\n                  </Grid>\r\n                  <Grid item xs={2}>\r\n                    {index === 0 ? (\r\n                      <IconButton onClick={addPaymentSplitRow} color=\"primary\">\r\n                        <AddCircle />\r\n                      </IconButton>\r\n                    ) : (\r\n                      <IconButton onClick={() => removePaymentSplitRow(index)} color=\"secondary\">\r\n                        <RemoveCircle />\r\n                      </IconButton>\r\n                    )}\r\n                  </Grid>\r\n                </Grid>\r\n              ))}\r\n            </Grid>\r\n            <br></br>\r\n            {estimate.creditFlag && (\r\n              <Grid container direction=\"row\" spacing={gridSpacing}>\r\n                <Grid item xs={4}>\r\n                  <Typography variant=\"h4\">Credit Payment</Typography>\r\n                </Grid>\r\n                {(estimate.creditPaymentList || []).map((credit, index) => (\r\n                  <Grid container item spacing={gridSpacing} key={index} alignItems=\"center\">\r\n                    <Grid item xs={4}>\r\n                      <TextField\r\n                        label=\"Credit Amount\"\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        required\r\n                        value={credit.amount}\r\n                        onChange={(e) => handleCreditPaymentChange(index, 'amount', parseFloat(e.target.value) || 0)}\r\n                        type=\"number\"\r\n                      />\r\n                    </Grid>\r\n                    <Grid item xs={3}>\r\n                      <TextField\r\n                        select\r\n                        label=\"Payment Mode\"\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        required\r\n                        value={credit.paymentMode}\r\n                        onChange={(e) => handleCreditPaymentChange(index, 'paymentMode', e.target.value)}\r\n                      >\r\n                        {paymentModes\r\n                          .filter((mode) => mode !== 'CREDIT') // Exclude \"CREDIT\"\r\n                          .map((mode) => (\r\n                            <MenuItem key={mode} value={mode}>\r\n                              {mode}\r\n                            </MenuItem>\r\n                          ))}\r\n                      </TextField>\r\n                    </Grid>\r\n                    <Grid item xs={4}>\r\n                      <TextField\r\n                        label=\"Comment\"\r\n                        variant=\"outlined\"\r\n                        fullWidth\r\n                        value={credit.comment || ''}\r\n                        onChange={(e) => handleCreditPaymentChange(index, 'comment', e.target.value)}\r\n                      />\r\n                    </Grid>\r\n                    <Grid item xs={1}>\r\n                      <IconButton onClick={() => removeCreditPaymentRow(index)} color=\"secondary\">\r\n                        <RemoveCircle />\r\n                      </IconButton>\r\n                    </Grid>\r\n                  </Grid>\r\n                ))}\r\n                <Grid item xs={12}>\r\n                  <Button onClick={addCreditPaymentRow} color=\"primary\" startIcon={<AddCircle />}>\r\n                    Add Credit Payment\r\n                  </Button>\r\n                </Grid>\r\n              </Grid>\r\n            )}\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button onClick={handleEstimateSave} color=\"secondary\">\r\n              Save\r\n            </Button>\r\n            <Button onClick={handleClose} color=\"secondary\">\r\n              Close\r\n            </Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n      )}\r\n      {confirmDialogOpen && (\r\n        <Dialog open={confirmDialogOpen} onClose={handleCloseConfirmDialog}>\r\n          <DialogTitle>Confirm Remaining Amount</DialogTitle>\r\n          <DialogContent>\r\n            <p>\r\n              The remaining amount of <b>{remainingAmount}</b> will be added as CREDIT. Do you want to proceed?\r\n            </p>\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button onClick={handleConfirmAddCredit} color=\"primary\">\r\n              Yes\r\n            </Button>\r\n            <Button onClick={handleCloseConfirmDialog} color=\"secondary\">\r\n              No\r\n            </Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nBillPayment.propTypes = {\r\n  estimate: PropTypes.object.isRequired,\r\n  setEstimate: PropTypes.func.isRequired,\r\n  paymentModes: PropTypes.array.isRequired,\r\n  estimateCreateOpen: PropTypes.bool.isRequired,\r\n  handleClose: PropTypes.func.isRequired,\r\n  setAlertMess: PropTypes.func.isRequired,\r\n  setShowAlert: PropTypes.func.isRequired,\r\n  setAlertColor: PropTypes.func.isRequired\r\n};\r\nexport default BillPayment;\r\n","\"use client\";\n\nimport createSvgIcon from './utils/createSvgIcon';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default createSvgIcon( /*#__PURE__*/_jsx(\"path\", {\n  d: \"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z\"\n}), 'RemoveCircle');"],"names":["_ref","estimate","setEstimate","paymentModes","estimateCreateOpen","handleClose","setAlertMess","setShowAlert","setAlertColor","confirmDialogOpen","setConfirmDialogOpen","useState","remainingAmount","setRemainingAmount","useEffect","handlePaymentSplitChange","index","field","value","updatedPaymentSplitList","paymentSplitList","totalPaidExcludingCredit","filter","split","paymentMode","reduce","sum","paymentAmount","pendingAmount","grandTotal","prevState","creditFlag","some","addPaymentSplitRow","alert","handleCloseConfirmDialog","handleCreditPaymentChange","updatedCreditPaymentList","creditPaymentList","_jsxs","_Fragment","children","Dialog","open","onClose","scroll","fullWidth","maxWidth","DialogTitle","id","sx","fontSize","vehicleRegNo","DialogContent","dividers","_jsx","Grid","container","direction","spacing","gridSpacing","item","xs","TextField","label","required","variant","map","alignItems","onChange","e","parseFloat","target","type","select","mode","MenuItem","IconButton","onClick","color","AddCircle","_","i","removePaymentSplitRow","RemoveCircle","Typography","credit","amount","comment","totalCreditPayments","newPendingAmount","creditSettledFlag","removeCreditPaymentRow","Button","addCreditPaymentRow","payment","cred","startIcon","DialogActions","async","remaining","console","log","handleOpenConfirmDialog","updatedEstimate","data","postRequest","estimateId","err","message","handleConfirmAddCredit","createSvgIcon","d"],"sourceRoot":""}