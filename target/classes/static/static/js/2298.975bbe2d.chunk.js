"use strict";(self.webpackChunkcar_wash_management=self.webpackChunkcar_wash_management||[]).push([[2298],{22298:function(e,t,n){n.r(t);var a=n(72791),i=n(5574),l=n(65661),r=n(39157),s=n(61889),o=n(48550),d=n(23786),c=n(13400),m=n(20890),p=n(94294),u=n(97123),y=n(91923),h=n(19035),g=n(22840),x=n(6879),j=n(80184);t.default=e=>{let{invoice:t,setInvoice:n,paymentModes:f,invoiceCreateOpen:v,handleClose:Z,setAlertMess:C,setShowAlert:D,setAlertColor:P}=e;const[A,E]=(0,a.useState)(!1),[L,b]=(0,a.useState)(0);(0,a.useEffect)((()=>()=>{b(0)}),[]);const S=(e,a,i)=>{const l=[...t.paymentSplitList],r=l[e],s={...r,[a]:i};r.paymentId&&"ADD"!==r.flag&&(s.flag="MODIFY"),l[e]=s;const o=l.filter((e=>"CREDIT"!==e.paymentMode)).reduce(((e,t)=>e+(t.paymentAmount||0)),0),d=(t.grandTotal||0)-o;n((e=>({...e,paymentSplitList:l,pendingAmount:d>0?d:0,creditFlag:l.some((e=>"CREDIT"===e.paymentMode))})))},T=()=>{const e=(t.grandTotal||0)-t.paymentSplitList.reduce(((e,t)=>e+(t.paymentAmount||0)),0);e<=0?alert("No remaining amount to allocate. Please adjust the existing payment splits."):n((t=>({...t,paymentSplitList:[...t.paymentSplitList,{paymentAmount:e,paymentMode:"CASH",flag:"ADD"}]})))},M=()=>{E(!1)},I=(e,a,i)=>{const l=[...t.creditPaymentList],r=l[e],s={...r,[a]:i};r.paymentId&&"ADD"!==r.flag&&(s.flag="MODIFY"),l[e]=s,n((e=>({...e,creditPaymentList:l})))};return(0,j.jsxs)(j.Fragment,{children:[v&&(0,j.jsxs)(i.Z,{open:v,onClose:Z,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",fullWidth:!0,maxWidth:"lg",children:[(0,j.jsxs)(l.Z,{id:"scroll-dialog-title",sx:{fontSize:"1.0rem"},children:["Invoice Generation for ",t.vehicleRegNo]}),(0,j.jsxs)(r.Z,{dividers:"paper"===scroll,children:[(0,j.jsx)("br",{}),(0,j.jsxs)(s.ZP,{container:!0,direction:"row",spacing:y.dv,children:[(0,j.jsx)(s.ZP,{item:!0,xs:6,children:(0,j.jsx)(o.Z,{label:"Grand Total",required:!0,variant:"outlined",value:(null===t||void 0===t?void 0:t.grandTotal)||0})}),t.paymentSplitList.filter((e=>"DELETE"!==e.flag)).map(((e,a)=>(0,j.jsxs)(s.ZP,{container:!0,item:!0,spacing:y.dv,alignItems:"center",children:[(0,j.jsx)(s.ZP,{item:!0,xs:5,children:(0,j.jsx)(o.Z,{label:"Payment Amount",variant:"outlined",fullWidth:!0,required:!0,value:e.paymentAmount,onChange:e=>S(a,"paymentAmount",parseFloat(e.target.value)||0),type:"number",disabled:!!e.paymentDate})}),(0,j.jsx)(s.ZP,{item:!0,xs:5,children:(0,j.jsx)(o.Z,{select:!0,label:"Payment Mode",variant:"outlined",fullWidth:!0,required:!0,value:e.paymentMode||"CASH",disabled:!!e.paymentDate,onChange:e=>S(a,"paymentMode",e.target.value),children:f.map((e=>(0,j.jsx)(d.Z,{value:e,children:e},e)))})}),(0,j.jsx)(s.ZP,{item:!0,xs:2,children:0===a?(0,j.jsx)(c.Z,{onClick:T,color:"primary",disabled:!!e.paymentDate,children:(0,j.jsx)(g.Z,{})}):(0,j.jsx)(c.Z,{onClick:()=>(e=>{const a=[...t.paymentSplitList],i=a[e];"ADD"===i.flag?a.splice(e,1):a[e]={...i,flag:"DELETE"},n((e=>({...e,paymentSplitList:a})))})(a),color:"secondary",disabled:!!e.paymentDate,children:(0,j.jsx)(x.Z,{})})})]},a)))]}),(0,j.jsx)("br",{}),t.creditFlag&&(0,j.jsxs)(s.ZP,{container:!0,direction:"row",spacing:y.dv,children:[(0,j.jsx)(s.ZP,{item:!0,xs:4,children:(0,j.jsx)(m.Z,{variant:"h4",children:"Credit Payment"})}),(t.creditPaymentList||[]).filter((e=>"DELETE"!==e.flag)).map(((e,a)=>(0,j.jsxs)(s.ZP,{container:!0,item:!0,spacing:y.dv,alignItems:"center",children:[(0,j.jsx)(s.ZP,{item:!0,xs:4,children:(0,j.jsx)(o.Z,{label:"Credit Amount",variant:"outlined",fullWidth:!0,required:!0,value:e.amount,onChange:e=>I(a,"amount",parseFloat(e.target.value)||0),type:"number",disabled:!!e.creditDate})}),(0,j.jsx)(s.ZP,{item:!0,xs:3,children:(0,j.jsx)(o.Z,{select:!0,label:"Payment Mode",variant:"outlined",fullWidth:!0,required:!0,value:e.paymentMode||"CASH",disabled:!!e.creditDate,onChange:e=>I(a,"paymentMode",e.target.value),children:f.filter((e=>"CREDIT"!==e)).map((e=>(0,j.jsx)(d.Z,{value:e,children:e},e)))})}),(0,j.jsx)(s.ZP,{item:!0,xs:4,children:(0,j.jsx)(o.Z,{label:"Comment",variant:"outlined",fullWidth:!0,value:e.comment||"",disabled:!!e.creditDate,onChange:e=>I(a,"comment",e.target.value)})}),(0,j.jsx)(s.ZP,{item:!0,xs:1,children:(0,j.jsx)(c.Z,{onClick:()=>(e=>{const a=[...t.creditPaymentList],i=a[e];"ADD"===i.flag?a.splice(e,1):a[e]={...i,flag:"DELETE"};const l=a.filter((e=>"DELETE"!==e.flag)).reduce(((e,t)=>e+(t.amount||0)),0),r=(t.grandTotal||0)-l;n((e=>({...e,creditPaymentList:a,pendingAmount:r>0?r:0,creditSettledFlag:0===r})))})(a),color:"secondary",disabled:!!e.creditDate,children:(0,j.jsx)(x.Z,{})})})]},a))),(0,j.jsx)(s.ZP,{item:!0,xs:12,children:(0,j.jsx)(p.Z,{onClick:()=>{const e=(t.grandTotal||0)-t.paymentSplitList.filter((e=>"CREDIT"!==e.paymentMode)).reduce(((e,t)=>e+(t.paymentAmount||0)),0)-t.creditPaymentList.reduce(((e,t)=>e+(t.amount||0)),0);e<=0?alert("No remaining amount to allocate. Please adjust the existing payment splits."):n((t=>({...t,creditPaymentList:[...t.creditPaymentList||[],{amount:e,paymentMode:"CASH",comment:"",flag:"ADD"}]})))},color:"primary",startIcon:(0,j.jsx)(g.Z,{}),children:"Add Credit Payment"})})]})]}),(0,j.jsxs)(u.Z,{children:[(0,j.jsx)(p.Z,{onClick:Z,color:"secondary",children:"Close"}),(0,j.jsx)(p.Z,{onClick:async()=>{if(t.grandTotal<=0)return void alert("Grand total is 0. Cannot generate bill");const e=t.grandTotal||0,n=t.paymentSplitList.filter((e=>"DELETE"!==e.flag)),a=e-n.reduce(((e,t)=>e+(t.paymentAmount||0)),0);if(n.some((e=>!e.paymentMode)))return void alert("Please select a payment mode for all entries.");if(a>0)return void(e=>{b(e),E(!0)})(a);if(a<0)return void alert("Payment exceeds the grand total. Please adjust the amounts.");const i=t.creditPaymentList.filter((e=>"DELETE"!==e.flag));if(i.some((e=>!e.paymentMode)))return void alert("Please select a payment mode for all entries.");const l=i.reduce(((e,t)=>e+(t.amount||0)),0),r=e-n.filter((e=>"CREDIT"!==e.paymentMode)).reduce(((e,t)=>e+(t.paymentAmount||0)),0)-l,s={...t,pendingAmount:r>0?r:0,creditSettledFlag:!(r>0)};try{const e=await(0,h.j0)("/invoice",s);C("Bill id "+e.invoiceId+" saved successfully"),P("success"),D(!0),Z()}catch(o){C(o.message),P("info"),D(!0),Z()}},color:"secondary",children:"Save"})]})]}),A&&(0,j.jsxs)(i.Z,{open:A,onClose:M,children:[(0,j.jsx)(l.Z,{children:"Confirm Remaining Amount"}),(0,j.jsx)(r.Z,{children:(0,j.jsxs)("p",{children:["The remaining amount of ",(0,j.jsx)("b",{children:L})," will be added as CREDIT. Do you want to proceed?"]})}),(0,j.jsxs)(u.Z,{children:[(0,j.jsx)(p.Z,{onClick:()=>{E(!1),n((e=>({...e,paymentSplitList:[...e.paymentSplitList,{paymentAmount:L,paymentMode:"CREDIT"}],pendingAmount:L,creditFlag:!0})))},color:"primary",children:"Yes"}),(0,j.jsx)(p.Z,{onClick:M,color:"secondary",children:"No"})]})]})]})}},6879:function(e,t,n){var a=n(76189),i=n(80184);t.Z=(0,a.Z)((0,i.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"}),"RemoveCircle")}}]);
//# sourceMappingURL=2298.975bbe2d.chunk.js.map