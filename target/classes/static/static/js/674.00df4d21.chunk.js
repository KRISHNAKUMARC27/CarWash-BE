"use strict";(self.webpackChunkcar_wash_management=self.webpackChunkcar_wash_management||[]).push([[674],{70674:function(e,t,o){o.r(t),o.d(t,{default:function(){return L}});var s=o(72791),a=o(68899),r=o(13967),l=o(61979),i=o(44507),n=o(5574),c=o(97123),d=o(39157),h=o(20068),m=o(13400),u=o(65661),g=o(68096),j=o(94925),b=o(58406),p=o(23786),x=o(94294),y=o(64554),v=o(76189),C=o(80184),S=(0,v.Z)((0,C.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew"),w=o(22840),Z=(0,v.Z)((0,C.jsx)("path",{d:"M13.66 7c-.56-1.18-1.76-2-3.16-2H6V3h12v2h-3.26c.48.58.84 1.26 1.05 2H18v2h-2.02c-.25 2.8-2.61 5-5.48 5h-.73l6.73 7h-2.77L7 14v-2h3.5c1.76 0 3.22-1.3 3.46-3H6V7h7.66z"}),"CurrencyRupee"),N=(0,v.Z)((0,C.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm1 10h-4v1h3c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1h-1v1h-2v-1H9v-2h4v-1h-3c-.55 0-1-.45-1-1v-3c0-.55.45-1 1-1h1V9h2v1h2v2zm-2-4V3.5L17.5 8H13z"}),"RequestQuote"),f=o(19035),z=o(44713),O=o(29464);const A=(0,z.Z)((0,s.lazy)((()=>o.e(2298).then(o.bind(o,22298))))),E=(0,z.Z)((0,s.lazy)((()=>o.e(5840).then(o.bind(o,58203))))),M=(0,z.Z)((0,s.lazy)((()=>o.e(627).then(o.bind(o,90627))))),I=(0,z.Z)((0,s.lazy)((()=>Promise.all([o.e(5587),o.e(7862)]).then(o.bind(o,77862))))),k=e=>{let{cell:t}=e;return(0,C.jsx)(y.Z,{component:"span",sx:()=>({cursor:"pointer",backgroundColor:"OPEN"===t.getValue()?"green":"red",borderRadius:"0.35rem",maxWidth:"9ch",p:"0.25rem"}),children:t.getValue()})};var L=()=>{const[e,t]=(0,s.useState)([]),[o,v]=(0,s.useState)(!1),[z,L]=(0,s.useState)({}),[P,K]=(0,s.useState)(!1),[V,F]=(0,s.useState)(!1),[R,T]=s.useState(!1),[D,H]=s.useState(""),[_,J]=s.useState(""),G=JSON.parse(localStorage.getItem("roles"))||[],W=["INVOICE"],q=["ESTIMATE"],B=G.some((e=>W.includes(e))),Q=G.some((e=>q.includes(e))),U=G.some((e=>["ADMIN"].includes(e))),[X,Y]=(0,s.useState)(!1),[$,ee]=(0,s.useState)(),[te,oe]=(0,s.useState)(!1),[se,ae]=(0,s.useState)(),[re,le]=(0,s.useState)([]);(0,s.useEffect)((()=>(ie(),ne(),()=>{t([]),v(!1),L({}),K(!1),F(!1),le([])})),[]);const ie=async()=>{try{const e=await(0,f.A_)("/jobCard");t(e)}catch(e){console.error(e.message)}},ne=async()=>{try{const e=await(0,f.A_)("/config/paymentmodes");le(e)}catch(e){console.log(e.message)}},ce=()=>{L({}),v(!1),K(!1),F(!1),Y(!1),oe(!1),ee({}),ae({}),ie()},de=async e=>{if("OPEN"===e.jobStatus&&!U)return H("Not authorized to Re-Open the job"),J("error"),void T(!0);try{await(0,f.GH)("/jobCard/jobStatus",e),L({}),v(!1),ie()}catch(t){console.log(t.message),H(t.message),J("info"),T(!0),L({}),v(!1)}},he=async e=>{try{const t=await(0,f.A_)("/jobCard/jobSpares/"+e.id);ee((o=>({...o,jobId:e.jobId,ownerName:e.ownerName,ownerPhoneNumber:e.ownerPhoneNumber,vehicleRegNo:e.vehicleRegNo,vehicleName:e.vehicleName,grandTotal:t.grandTotalWithGST,jobObjId:t.id,paymentSplitList:[{paymentAmount:t.grandTotalWithGST||0,paymentMode:""}],creditPaymentList:[]}))),Y(!0)}catch(t){console.log(t.message)}},me=async e=>{try{const t=await(0,f.A_)("/jobCard/jobSpares/"+e.id);ae((o=>({...o,jobId:e.jobId,ownerName:e.ownerName,ownerPhoneNumber:e.ownerPhoneNumber,vehicleRegNo:e.vehicleRegNo,vehicleName:e.vehicleName,grandTotal:t.grandTotal,jobObjId:t.id,paymentSplitList:[{paymentAmount:t.grandTotal||0,paymentMode:""}],creditPaymentList:[]}))),oe(!0)}catch(t){console.log(t.message)}},ue=(0,s.useMemo)((()=>[{accessorKey:"jobId",header:"JobCard No.",size:50},{accessorKey:"jobStatus",header:"Status",size:50,filterVariant:"select",filterSelectOptions:["OPEN","CLOSED","CANCELLED"],Header:(0,C.jsx)("i",{style:{color:"blue"},children:"Status"}),Cell:k,muiTableBodyCellProps:e=>{let{cell:t}=e;return{onClick:()=>{L(t.row.original),v(!0)}}}},{accessorKey:"ownerName",header:"Owner",size:100},{accessorKey:"ownerPhoneNumber",header:"Phone",size:100},{accessorKey:"vehicleRegNo",header:"Reg. No.",size:100},{accessorKey:"vehicleName",header:"Vehicle",size:50},{accessorKey:"kiloMeters",header:"kiloMeters",size:50},{accessorKey:"jobCreationDate",header:"Job Open Date",size:150},{accessorKey:"jobCloseDate",header:"Job Closed Date",size:150},{accessorKey:"ownerAddress",header:"Address",size:150},{accessorKey:"nextFreeCheckKms",header:"Next FreeCheck KMs",size:50},{accessorKey:"nextServiceKms",header:"Next Service KMs",size:50}]),[]),ge=(0,r.Z)(),je=(0,s.useMemo)((()=>(0,l.Z)({palette:{mode:ge.palette.mode,primary:ge.palette.secondary,info:{main:"rgb(255,122,0)"},background:{default:"rgba(0, 0, 0, 0)"}},typography:{button:{textTransform:"none",fontSize:"1.2rem"}},components:{MuiTooltip:{styleOverrides:{tooltip:{fontSize:"1.1rem"}}},MuiSwitch:{styleOverrides:{thumb:{color:"pink"}}}}})),[ge]);return(0,C.jsxs)("div",{children:[R&&(0,C.jsx)(O.Z,{showAlert:R,setShowAlert:T,alertColor:_,alertMess:D}),(0,C.jsxs)(i.Z,{theme:je,children:[(0,C.jsx)(a.P2,{columns:ue,data:e,editingMode:"modal",enableEditing:!0,initialState:{pagination:{pageSize:10}},muiTablePaperProps:{elevation:0,sx:{borderRadius:"0",background:"linear-gradient(195deg, #fff, #c38b81)"}},renderRowActions:e=>{let{row:t}=e;return(0,C.jsxs)(y.Z,{sx:{display:"flex",gap:"1rem"},children:[(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"View Job Card",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),K(!0)},children:(0,C.jsx)(S,{})})}),(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Create Job Card",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),F(!0)},children:(0,C.jsx)(w.Z,{})})}),B&&"CLOSED"===t.original.jobStatus&&(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Invoice",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),(async e=>{if(null!=e.invoiceObjId)try{const t=await(0,f.A_)("/invoice/"+e.invoiceObjId);ee(t),Y(!0)}catch(t){console.log(t.message),he(e)}else he(e)})(t.original)},children:(0,C.jsx)(Z,{})})}),Q&&"CLOSED"===t.original.jobStatus&&(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Estimate",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),(async e=>{if(null!=e.estimateObjId)try{const t=await(0,f.A_)("/estimate/"+e.estimateObjId);ae(t),oe(!0)}catch(t){console.log(t.message),me(e)}else me(e)})(t.original)},children:(0,C.jsx)(N,{})})})]})}})," "]}),o&&(0,C.jsxs)(n.Z,{open:o,onClose:ce,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[(0,C.jsx)(y.Z,{sx:{bgcolor:"#f44336",color:"#FFFFFF",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.25rem"},children:(0,C.jsx)(u.Z,{id:"scroll-dialog-title",sx:{flexGrow:1,fontSize:"1.5rem",color:"white"},children:z.vehicleRegNo})}),(0,C.jsx)(d.Z,{dividers:"paper"===scroll,children:(0,C.jsxs)(g.Z,{variant:"outlined",style:{margin:"1px 0"},children:[(0,C.jsx)(j.Z,{children:"Job Status"}),(0,C.jsxs)(b.Z,{value:(null===z||void 0===z?void 0:z.jobStatus)||"",onChange:e=>{const t={...z,jobStatus:e.target.value};L(t)},label:"Status",children:[(0,C.jsx)(p.Z,{value:"CLOSED",children:"CLOSED"}),(0,C.jsx)(p.Z,{value:"OPEN",children:"OPEN"}),(0,C.jsx)(p.Z,{value:"CANCELLED",children:"CANCELLED"})]})]})}),(0,C.jsxs)(c.Z,{children:[(0,C.jsx)(x.Z,{onClick:()=>{de(z),ie(),ce()},color:"primary",children:"Save"}),(0,C.jsx)(x.Z,{onClick:ce,color:"secondary",children:"Close"})]})]}),V&&(0,C.jsxs)(n.Z,{open:V,onClose:ce,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",fullWidth:!0,maxWidth:"lg",children:[(0,C.jsx)(y.Z,{sx:{bgcolor:"#f44336",color:"#FFFFFF",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.25rem"},children:(0,C.jsxs)(u.Z,{id:"scroll-dialog-title",sx:{flexGrow:1,fontSize:"1.5rem",color:"white"},children:["New JobCard for ",z.vehicleRegNo]})}),(0,C.jsx)(d.Z,{dividers:"paper"===scroll,children:(0,C.jsx)(I,{data:z})}),(0,C.jsx)(c.Z,{children:(0,C.jsx)(x.Z,{onClick:ce,color:"secondary",children:"Close"})})]}),P&&(0,C.jsx)(M,{open:P,onClose:ce,job:z}),X&&(0,C.jsx)(A,{invoice:$,setInvoice:ee,paymentModes:re,invoiceCreateOpen:X,handleClose:ce,setAlertMess:H,setShowAlert:T,setAlertColor:J}),te&&(0,C.jsx)(E,{estimate:se,setEstimate:ae,paymentModes:re,estimateCreateOpen:te,handleClose:ce,setAlertMess:H,setShowAlert:T,setAlertColor:J})]})}},22840:function(e,t,o){var s=o(76189),a=o(80184);t.Z=(0,s.Z)((0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddCircle")}}]);
//# sourceMappingURL=674.00df4d21.chunk.js.map