"use strict";(self.webpackChunkcar_wash_management=self.webpackChunkcar_wash_management||[]).push([[674],{70674:function(e,t,s){s.r(t),s.d(t,{default:function(){return D}});var o=s(72791),a=s(68899),r=s(13967),l=s(61979),i=s(44507),n=s(5574),c=s(97123),d=s(39157),h=s(20068),m=s(13400),u=s(65661),g=s(68096),j=s(94925),b=s(58406),p=s(23786),x=s(94294),y=s(64554),v=s(76189),C=s(80184),S=(0,v.Z)((0,C.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew"),N=s(22840),w=(0,v.Z)((0,C.jsx)("path",{d:"M13.66 7c-.56-1.18-1.76-2-3.16-2H6V3h12v2h-3.26c.48.58.84 1.26 1.05 2H18v2h-2.02c-.25 2.8-2.61 5-5.48 5h-.73l6.73 7h-2.77L7 14v-2h3.5c1.76 0 3.22-1.3 3.46-3H6V7h7.66z"}),"CurrencyRupee"),Z=(0,v.Z)((0,C.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm1 10h-4v1h3c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1h-1v1h-2v-1H9v-2h4v-1h-3c-.55 0-1-.45-1-1v-3c0-.55.45-1 1-1h1V9h2v1h2v2zm-2-4V3.5L17.5 8H13z"}),"RequestQuote"),f=s(19035),A=s(44713),z=s(29464);const O=(0,A.Z)((0,o.lazy)((()=>s.e(2298).then(s.bind(s,22298))))),M=(0,A.Z)((0,o.lazy)((()=>s.e(5840).then(s.bind(s,58203))))),E=(0,A.Z)((0,o.lazy)((()=>s.e(627).then(s.bind(s,90627))))),I=(0,A.Z)((0,o.lazy)((()=>Promise.all([s.e(5587),s.e(7862)]).then(s.bind(s,77862))))),k=e=>{let{cell:t}=e;return(0,C.jsx)(y.Z,{component:"span",sx:()=>({cursor:"pointer",backgroundColor:"OPEN"===t.getValue()?"green":"red",borderRadius:"0.35rem",maxWidth:"9ch",p:"0.25rem"}),children:t.getValue()})};var D=()=>{const[e,t]=(0,o.useState)([]),[s,v]=(0,o.useState)(!1),[A,D]=(0,o.useState)({}),[L,P]=(0,o.useState)(!1),[V,K]=(0,o.useState)(!1),[R,F]=o.useState(!1),[H,T]=o.useState(""),[_,J]=o.useState(""),G=JSON.parse(localStorage.getItem("roles"))||[],W=["INVOICE","ADMIN","MANAGER"],q=["ESTIMATE","ADMIN","MANAGER"],B=G.some((e=>W.includes(e))),Q=G.some((e=>q.includes(e))),$=G.some((e=>["ADMIN"].includes(e))),[U,X]=(0,o.useState)(!1),[Y,ee]=(0,o.useState)(),[te,se]=(0,o.useState)(!1),[oe,ae]=(0,o.useState)(),[re,le]=(0,o.useState)([]);(0,o.useEffect)((()=>(ie(),ne(),()=>{t([]),v(!1),D({}),P(!1),K(!1),le([])})),[]);const ie=async()=>{try{const e=await(0,f.A_)("/jobCard");t(e)}catch(e){console.error(e.message)}},ne=async()=>{try{const e=await(0,f.A_)("/config/paymentmodes");le(e)}catch(e){console.log(e.message)}},ce=()=>{D({}),v(!1),P(!1),K(!1),X(!1),se(!1),ee({}),ae({}),ie()},de=async e=>{if("OPEN"===e.jobStatus&&!$)return T("Not authorized to Re-Open the job"),J("error"),void F(!0);try{await(0,f.GH)("/jobCard/jobStatus",e),D({}),v(!1),ie()}catch(t){console.log(t.message),T(t.message),J("info"),F(!0),D({}),v(!1)}},he=async e=>{try{const t=await(0,f.A_)("/jobCard/jobSpares/"+e.id);ee((s=>({...s,jobId:e.jobId,ownerName:e.ownerName,ownerPhoneNumber:e.ownerPhoneNumber,vehicleRegNo:e.vehicleRegNo,vehicleName:e.vehicleName,grandTotal:t.grandTotalWithGST,jobObjId:t.id,paymentSplitList:[{paymentAmount:t.grandTotalWithGST||0,paymentMode:"CASH",flag:"ADD"}],creditPaymentList:[]}))),X(!0)}catch(t){console.log(t.message)}},me=async e=>{try{const t=await(0,f.A_)("/jobCard/jobSpares/"+e.id);ae((s=>({...s,jobId:e.jobId,ownerName:e.ownerName,ownerPhoneNumber:e.ownerPhoneNumber,vehicleRegNo:e.vehicleRegNo,vehicleName:e.vehicleName,grandTotal:t.grandTotal,jobObjId:t.id,paymentSplitList:[{paymentAmount:t.grandTotal||0,paymentMode:"CASH",flag:"ADD"}],creditPaymentList:[]}))),se(!0)}catch(t){console.log(t.message)}},ue=(0,o.useMemo)((()=>[{accessorKey:"jobId",header:"JobCard No.",size:50},{accessorKey:"jobStatus",header:"Status",size:50,filterVariant:"select",filterSelectOptions:["OPEN","CLOSED","CANCELLED"],Header:(0,C.jsx)("i",{style:{color:"blue"},children:"Status"}),Cell:k,muiTableBodyCellProps:e=>{let{cell:t}=e;return{onClick:()=>{D(t.row.original),v(!0)}}}},{accessorKey:"ownerName",header:"Owner",size:100},{accessorKey:"ownerPhoneNumber",header:"Phone",size:100},{accessorKey:"vehicleRegNo",header:"Reg. No.",size:100},{accessorKey:"vehicleName",header:"Vehicle",size:50},{accessorKey:"kiloMeters",header:"kiloMeters",size:50},{accessorKey:"jobCreationDate",header:"Job Open Date",size:150},{accessorKey:"jobCloseDate",header:"Job Closed Date",size:150},{accessorKey:"ownerAddress",header:"Address",size:150},{accessorKey:"nextFreeCheckKms",header:"Next FreeCheck KMs",size:50},{accessorKey:"nextServiceKms",header:"Next Service KMs",size:50}]),[]),ge=(0,r.Z)(),je=(0,o.useMemo)((()=>(0,l.Z)({palette:{mode:ge.palette.mode,primary:ge.palette.secondary,info:{main:"rgb(255,122,0)"},background:{default:"rgba(0, 0, 0, 0)"}},typography:{button:{textTransform:"none",fontSize:"1.2rem"}},components:{MuiTooltip:{styleOverrides:{tooltip:{fontSize:"1.1rem"}}},MuiSwitch:{styleOverrides:{thumb:{color:"pink"}}}}})),[ge]);let be="#c38b81";return G.includes("INVOICE")&&(be="#71acda"),(0,C.jsxs)("div",{children:[R&&(0,C.jsx)(z.Z,{showAlert:R,setShowAlert:F,alertColor:_,alertMess:H}),(0,C.jsxs)(i.Z,{theme:je,children:[(0,C.jsx)(a.P2,{columns:ue,data:e,editingMode:"modal",enableEditing:!0,initialState:{pagination:{pageSize:10}},muiTablePaperProps:{elevation:0,sx:{borderRadius:"0",background:`linear-gradient(195deg, #fff, ${be})`}},renderRowActions:e=>{let{row:t}=e;return(0,C.jsxs)(y.Z,{sx:{display:"flex",gap:"1rem"},children:[(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"View Job Card",children:(0,C.jsx)(m.Z,{onClick:()=>{D(t.original),P(!0)},children:(0,C.jsx)(S,{})})}),(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Create Job Card",children:(0,C.jsx)(m.Z,{onClick:()=>{D(t.original),K(!0)},children:(0,C.jsx)(N.Z,{})})}),B&&"CLOSED"===t.original.jobStatus&&(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Invoice",children:(0,C.jsx)(m.Z,{onClick:()=>{D(t.original),(async e=>{if(null!=e.invoiceObjId)try{const t=await(0,f.A_)("/invoice/"+e.invoiceObjId);ee(t),X(!0)}catch(t){console.log(t.message),he(e)}else he(e)})(t.original)},children:(0,C.jsx)(w,{})})}),Q&&"CLOSED"===t.original.jobStatus&&(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Estimate",children:(0,C.jsx)(m.Z,{onClick:()=>{D(t.original),(async e=>{if(null!=e.estimateObjId)try{const t=await(0,f.A_)("/estimate/"+e.estimateObjId);ae(t),se(!0)}catch(t){console.log(t.message),me(e)}else me(e)})(t.original)},children:(0,C.jsx)(Z,{})})})]})}})," "]}),s&&(0,C.jsxs)(n.Z,{open:s,onClose:ce,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[(0,C.jsx)(y.Z,{sx:{bgcolor:"#f44336",color:"#FFFFFF",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.25rem"},children:(0,C.jsx)(u.Z,{id:"scroll-dialog-title",sx:{flexGrow:1,fontSize:"1.5rem",color:"white"},children:A.vehicleRegNo})}),(0,C.jsx)(d.Z,{dividers:"paper"===scroll,children:(0,C.jsxs)(g.Z,{variant:"outlined",style:{margin:"1px 0"},children:[(0,C.jsx)(j.Z,{children:"Job Status"}),(0,C.jsxs)(b.Z,{value:(null===A||void 0===A?void 0:A.jobStatus)||"",onChange:e=>{const t={...A,jobStatus:e.target.value};D(t)},label:"Status",children:[(0,C.jsx)(p.Z,{value:"CLOSED",children:"CLOSED"}),(0,C.jsx)(p.Z,{value:"OPEN",children:"OPEN"}),(0,C.jsx)(p.Z,{value:"CANCELLED",children:"CANCELLED"})]})]})}),(0,C.jsxs)(c.Z,{children:[(0,C.jsx)(x.Z,{onClick:ce,color:"secondary",children:"Close"}),(0,C.jsx)(x.Z,{onClick:()=>{de(A),ie(),ce()},color:"primary",children:"Save"})]})]}),V&&(0,C.jsxs)(n.Z,{open:V,onClose:ce,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",fullWidth:!0,maxWidth:"lg",children:[(0,C.jsx)(y.Z,{sx:{bgcolor:"#f44336",color:"#FFFFFF",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.25rem"},children:(0,C.jsxs)(u.Z,{id:"scroll-dialog-title",sx:{flexGrow:1,fontSize:"1.5rem",color:"white"},children:["New JobCard for ",A.vehicleRegNo]})}),(0,C.jsx)(d.Z,{dividers:"paper"===scroll,children:(0,C.jsx)(I,{data:A})}),(0,C.jsx)(c.Z,{children:(0,C.jsx)(x.Z,{onClick:ce,color:"secondary",children:"Close"})})]}),L&&(0,C.jsx)(E,{open:L,onClose:ce,job:A}),U&&(0,C.jsx)(O,{invoice:Y,setInvoice:ee,paymentModes:re,invoiceCreateOpen:U,handleClose:ce,setAlertMess:T,setShowAlert:F,setAlertColor:J}),te&&(0,C.jsx)(M,{estimate:oe,setEstimate:ae,paymentModes:re,estimateCreateOpen:te,handleClose:ce,setAlertMess:T,setShowAlert:F,setAlertColor:J})]})}},22840:function(e,t,s){var o=s(76189),a=s(80184);t.Z=(0,o.Z)((0,a.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddCircle")}}]);
//# sourceMappingURL=674.b08ed6fb.chunk.js.map