"use strict";(self.webpackChunkberry_free_material_react_cra=self.webpackChunkberry_free_material_react_cra||[]).push([[674],{70674:function(e,t,r){r.r(t),r.d(t,{default:function(){return L}});var o=r(72791),s=r(68899),a=r(13967),l=r(61979),i=r(44507),n=r(5574),c=r(97123),d=r(39157),h=r(20068),m=r(13400),u=r(65661),j=r(68096),b=r(94925),g=r(58406),p=r(23786),x=r(94294),y=r(64554),v=r(76189),C=r(80184),S=(0,v.Z)((0,C.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew"),Z=r(22840),w=(0,v.Z)((0,C.jsx)("path",{d:"M13.66 7c-.56-1.18-1.76-2-3.16-2H6V3h12v2h-3.26c.48.58.84 1.26 1.05 2H18v2h-2.02c-.25 2.8-2.61 5-5.48 5h-.73l6.73 7h-2.77L7 14v-2h3.5c1.76 0 3.22-1.3 3.46-3H6V7h7.66z"}),"CurrencyRupee"),N=(0,v.Z)((0,C.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm1 10h-4v1h3c.55 0 1 .45 1 1v3c0 .55-.45 1-1 1h-1v1h-2v-1H9v-2h4v-1h-3c-.55 0-1-.45-1-1v-3c0-.55.45-1 1-1h1V9h2v1h2v2zm-2-4V3.5L17.5 8H13z"}),"RequestQuote"),f=r(19035),z=r(44713),O=r(29464);const A=(0,z.Z)((0,o.lazy)((()=>r.e(2298).then(r.bind(r,22298))))),E=(0,z.Z)((0,o.lazy)((()=>r.e(5840).then(r.bind(r,58203))))),M=(0,z.Z)((0,o.lazy)((()=>r.e(627).then(r.bind(r,90627))))),I=(0,z.Z)((0,o.lazy)((()=>Promise.all([r.e(5587),r.e(7862)]).then(r.bind(r,77862))))),k=e=>{let{cell:t}=e;return(0,C.jsx)(y.Z,{component:"span",sx:()=>({cursor:"pointer",backgroundColor:"OPEN"===t.getValue()?"green":"red",borderRadius:"0.35rem",maxWidth:"9ch",p:"0.25rem"}),children:t.getValue()})};var L=()=>{const[e,t]=(0,o.useState)([]),[r,v]=(0,o.useState)(!1),[z,L]=(0,o.useState)({}),[P,K]=(0,o.useState)(!1),[V,F]=(0,o.useState)(!1),[R,T]=o.useState(!1),[_,D]=o.useState(""),[H,J]=o.useState(""),G=JSON.parse(localStorage.getItem("roles"))||[],W=["INVOICE"],q=["ESTIMATE"],B=G.some((e=>W.includes(e))),Q=G.some((e=>q.includes(e))),U=G.some((e=>["ADMIN"].includes(e))),[X,Y]=(0,o.useState)(!1),[$,ee]=(0,o.useState)(),[te,re]=(0,o.useState)(!1),[oe,se]=(0,o.useState)(),[ae,le]=(0,o.useState)([]);(0,o.useEffect)((()=>(ie(),ne(),()=>{t([]),v(!1),L({}),K(!1),F(!1),le([])})),[]);const ie=async()=>{try{const e=await(0,f.A_)("/jobCard");t(e)}catch(e){console.error(e.message)}},ne=async()=>{try{const e=await(0,f.A_)("/config/paymentmodes");le(e)}catch(e){console.log(e.message)}},ce=()=>{L({}),v(!1),K(!1),F(!1),Y(!1),re(!1),ee({}),se({}),ie()},de=async e=>{if("OPEN"===e.jobStatus&&!U)return D("Not authorized to Re-Open the job"),J("error"),void T(!0);try{await(0,f.GH)("/jobCard/jobStatus",e),L({}),v(!1),ie()}catch(t){console.log(t.message),D(t.message),J("info"),T(!0),L({}),v(!1)}},he=async e=>{try{const t=await(0,f.A_)("/jobCard/jobSpares/"+e.id);ee((r=>({...r,jobId:e.jobId,ownerName:e.ownerName,ownerPhoneNumber:e.ownerPhoneNumber,vehicleRegNo:e.vehicleRegNo,vehicleName:e.vehicleName,grandTotal:t.grandTotalWithGST,jobObjId:t.id,paymentSplitList:[{paymentAmount:t.grandTotalWithGST||0,paymentMode:""}],creditPaymentList:[]}))),Y(!0)}catch(t){console.log(t.message)}},me=async e=>{try{const t=await(0,f.A_)("/jobCard/jobSpares/"+e.id);se((r=>({...r,jobId:e.jobId,ownerName:e.ownerName,ownerPhoneNumber:e.ownerPhoneNumber,vehicleRegNo:e.vehicleRegNo,vehicleName:e.vehicleName,grandTotal:t.grandTotal,jobObjId:t.id,paymentSplitList:[{paymentAmount:t.grandTotal||0,paymentMode:""}],creditPaymentList:[]}))),re(!0)}catch(t){console.log(t.message)}},ue=(0,o.useMemo)((()=>[{accessorKey:"jobId",header:"JobCard No.",size:50},{accessorKey:"jobStatus",header:"Status",size:50,filterVariant:"select",filterSelectOptions:["OPEN","CLOSED","CANCELLED"],Header:(0,C.jsx)("i",{style:{color:"blue"},children:"Status"}),Cell:k,muiTableBodyCellProps:e=>{let{cell:t}=e;return{onClick:()=>{L(t.row.original),v(!0)}}}},{accessorKey:"ownerName",header:"Owner",size:100},{accessorKey:"ownerPhoneNumber",header:"Phone",size:100},{accessorKey:"vehicleRegNo",header:"Reg. No.",size:100},{accessorKey:"vehicleName",header:"Vehicle",size:50},{accessorKey:"kiloMeters",header:"kiloMeters",size:50},{accessorKey:"jobCreationDate",header:"Job Open Date",size:150},{accessorKey:"jobCloseDate",header:"Job Closed Date",size:150},{accessorKey:"ownerAddress",header:"Address",size:150},{accessorKey:"nextFreeCheckKms",header:"Next FreeCheck KMs",size:50},{accessorKey:"nextServiceKms",header:"Next Service KMs",size:50}]),[]),je=(0,a.Z)(),be=(0,o.useMemo)((()=>(0,l.Z)({palette:{mode:je.palette.mode,primary:je.palette.secondary,info:{main:"rgb(255,122,0)"},background:{default:"rgba(0, 0, 0, 0)"}},typography:{button:{textTransform:"none",fontSize:"1.2rem"}},components:{MuiTooltip:{styleOverrides:{tooltip:{fontSize:"1.1rem"}}},MuiSwitch:{styleOverrides:{thumb:{color:"pink"}}}}})),[je]);return(0,C.jsxs)("div",{children:[R&&(0,C.jsx)(O.Z,{showAlert:R,setShowAlert:T,alertColor:H,alertMess:_}),(0,C.jsxs)(i.Z,{theme:be,children:[(0,C.jsx)(s.P2,{columns:ue,data:e,editingMode:"modal",enableEditing:!0,initialState:{pagination:{pageSize:10}},muiTablePaperProps:{elevation:0,sx:{borderRadius:"0",background:"linear-gradient(195deg, #fff, #c38b81)"}},renderRowActions:e=>{let{row:t}=e;return(0,C.jsxs)(y.Z,{sx:{display:"flex",gap:"1rem"},children:[(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"View Job Card",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),K(!0)},children:(0,C.jsx)(S,{})})}),(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Create Job Card",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),F(!0)},children:(0,C.jsx)(Z.Z,{})})}),B&&"CLOSED"===t.original.jobStatus&&(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Invoice",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),(async e=>{if(null!=e.invoiceObjId)try{const t=await(0,f.A_)("/invoice/"+e.invoiceObjId);ee(t),Y(!0)}catch(t){console.log(t.message),he(e)}else he(e)})(t.original)},children:(0,C.jsx)(w,{})})}),Q&&"CLOSED"===t.original.jobStatus&&(0,C.jsx)(h.Z,{arrow:!0,placement:"right",title:"Estimate",children:(0,C.jsx)(m.Z,{onClick:()=>{L(t.original),(async e=>{if(null!=e.estimateObjId)try{const t=await(0,f.A_)("/estimate/"+e.estimateObjId);se(t),re(!0)}catch(t){console.log(t.message),me(e)}else me(e)})(t.original)},children:(0,C.jsx)(N,{})})})]})}})," "]}),r&&(0,C.jsxs)(n.Z,{open:r,onClose:ce,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[(0,C.jsx)(y.Z,{sx:{bgcolor:"#f44336",color:"#FFFFFF",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.25rem"},children:(0,C.jsx)(u.Z,{id:"scroll-dialog-title",sx:{flexGrow:1,fontSize:"1.5rem",color:"white"},children:z.vehicleRegNo})}),(0,C.jsx)(d.Z,{dividers:"paper"===scroll,children:(0,C.jsxs)(j.Z,{variant:"outlined",style:{margin:"1px 0"},children:[(0,C.jsx)(b.Z,{children:"Job Status"}),(0,C.jsxs)(g.Z,{value:(null===z||void 0===z?void 0:z.jobStatus)||"",onChange:e=>{const t={...z,jobStatus:e.target.value};L(t)},label:"Status",children:[(0,C.jsx)(p.Z,{value:"CLOSED",children:"CLOSED"}),(0,C.jsx)(p.Z,{value:"OPEN",children:"OPEN"}),(0,C.jsx)(p.Z,{value:"CANCELLED",children:"CANCELLED"})]})]})}),(0,C.jsxs)(c.Z,{children:[(0,C.jsx)(x.Z,{onClick:()=>{de(z),ie(),ce()},color:"primary",children:"Save"}),(0,C.jsx)(x.Z,{onClick:ce,color:"secondary",children:"Close"})]})]}),V&&(0,C.jsxs)(n.Z,{open:V,onClose:ce,scroll:"paper","aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",fullWidth:!0,maxWidth:"lg",children:[(0,C.jsx)(y.Z,{sx:{bgcolor:"#f44336",color:"#FFFFFF",display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.75rem 1.25rem"},children:(0,C.jsxs)(u.Z,{id:"scroll-dialog-title",sx:{flexGrow:1,fontSize:"1.5rem",color:"white"},children:["New JobCard for ",z.vehicleRegNo]})}),(0,C.jsx)(d.Z,{dividers:"paper"===scroll,children:(0,C.jsx)(I,{data:z})}),(0,C.jsx)(c.Z,{children:(0,C.jsx)(x.Z,{onClick:ce,color:"secondary",children:"Close"})})]}),P&&(0,C.jsx)(M,{open:P,onClose:ce,job:z}),X&&(0,C.jsx)(A,{invoice:$,setInvoice:ee,paymentModes:ae,invoiceCreateOpen:X,handleClose:ce,setAlertMess:D,setShowAlert:T,setAlertColor:J}),te&&(0,C.jsx)(E,{estimate:oe,setEstimate:se,paymentModes:ae,estimateCreateOpen:te,handleClose:ce,setAlertMess:D,setShowAlert:T,setAlertColor:J})]})}},22840:function(e,t,r){var o=r(76189),s=r(80184);t.Z=(0,o.Z)((0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"}),"AddCircle")}}]);
//# sourceMappingURL=674.86ff3164.chunk.js.map